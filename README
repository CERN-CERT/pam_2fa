2FA PAM MODULE
------------------


The PAM 2FA module provides a 2-factor authentication based on:
    - user account password ( "what you know" )
    - otp code sent with an SMS to user's mobile ( "what you have" )




Requirement(s)
--------------


You need the following packages installed in order to properly build, install and use this module:

    - Redhat/CentOS/SLC5-6 (rpm):              pam-devel
        For LDAP support:                      openldap, openldap-devel
        For Google Authenticator support:      curl, curl-devel
        For Yubikey support:                   ykclient, ykclient-devel (and curl, curl-devel)

    - Debian/Ubuntu (pkg) :                    libpam-dev
        For LDAP support:                      libldap, libldap-dev
        For Google Authenticator support:      libcurl, libcurl-dev
        For Yubikey support:                   libykclient, libykclient-dev (and libcurl, libcurl-dev)



Building
--------

In order to BUILD the pam module and to INSTALL you need to type the following commands:

    -----
        autoreconf -i
        ./configure
        make
        sudo make install
    -----

Note: You may want to use option --with-pam-dir in order to get the pam module be installed in the proper directory.


Configuration
-------------

In order to use this PAM-2FA module you need to configure your PAM setup by adding a line to an appropriate file in /etc/pam.d/Ã©

    -----
        auth    required    pam_2fa.so [ PARAMETERS ]
    -----

    PAM+SSH CONFIGURATION
    ----------
    In order to use PAM-2FA module with ssh connections, you need to do the following:

        - Add the preceding line with your parameters in /etc/pam.d/sshd

        - You also need to add the following line the file '/etc/ssh/sshd_config':

            -----
                ChallengeResponseAuthentication yes
                UsePAM yes
            -----
        - restart the ssh daemon with 'sudo /etc/init.d/sshd restart'




Required and supported PAM module paramaters are:

    -----
    "debug":                (Optional)

                            Will show every STDOUT messages in the console

    "retry":                (Optional)

                            Specify the MAX number of trials allowed to user in order to enter the 2nd factor.
                            If the user reaches the specified number of trials, the authentication will be considered as failed.

                            Default: 3

    "otp_length":           (Optional)

                            Speficy the length of the OTP code, i.e the number of digits.

                            Default: 6

    "capath":               (Optional)

                            Speficy the path where trusted certificates are.

    "ldap_uri":             (Mandatory for LDAP support)

                            Specify the LDAP Server URI ( e.g. ldap://xldap.cern.ch )

    "ldap_attr":            (Mandatory for LDAP support)

                            Specify the attribute to search in a specific entry in order to return its value.
                            For the PAM-2FA module, this attribute has to be the one which has the MOBILE PHONE NUMBER

                            ( e.g. altSecurityIdentities )

    "ldap_base_dn":         (Mandatory for LDAP support)

                            The Distinguished Name (DN) at which the ldap search must start in order to find the entry-ies

                            ( e.g. OU=Users,OU=Organic Units,DC=cern,DC=ch )

    "gauth_prefix":         (Optional)

                            Specifiy the prefix used to distinguish Google Authenticator mapping in LDAP

                            Default: "GAuth:"

    "gauth_ws_uri":         (Mandatory for Google Authenticator support)

                            Specify the Google Authenticator Web Service URI

    "gauth_ws_action":      (Optional)

                            Specify the Google Authenticator Web Service function name to check users' OTP

                            Default: CheckUser

    "sms_prefix":           (Optional)

                            Specifiy the prefix used to distinguish SMSOTP mapping in LDAP

                            Default: "SMS:"

    "sms_gateway":          (Mandatory for SMS OTP support)

                            Specify the SMS gateway to which emails should be sent in order to send SMS to users

    "sms_subject":          (Optional)

                            Speficy the Subject field for SMS

                            Default: ''

    "sms_text":             (Optional)

                            Specify the body and content of the message you are sending.

                            Default: "Your code for authentication code is: "

    "yk_prefix":            (Optional)

                            Specifiy the prefix used to distinguish Yubikey mapping in LDAP

                            Default: "YubiKey:"

    "yk_uri":               (Optional)

                            Specify the Yubikey server URI (if you have your internal server)

                            Default: use Yubico server pool

    "yk_id":                (Mandatory for Yubikey support)

                            Specify the client ID (see ykclient doc)

    "yk_key":               (Optional)

                            Set the client key (for extra client authentication against the Yubikey server)

                            Default: None

    "yk_user_file":         (Optional)

                            Specify the path (relative to user home) to the trusted yubikeys
                            Used when there is no LDAP support and for user 'root'

                            Default: .ssh/trusted_yubikeys
    -----


SYSLOG
-------

The PAM-2FA module will write log messages into system syslog the information about every login attempt (success or failure) and the reason of failure ( wrong code, too much retries, mobile number not found...)


You can find these log messages in the following file :

    -----
        Redhat/CentOS/SLC5-6 :      /var/log/secure
    -----
